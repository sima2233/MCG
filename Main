import java.util.Random;
import java.util.Scanner;

public class Main {
    static Scanner input = new Scanner(System.in);
    static Random rand = new Random();

    public static void main(String[] args) {
        while (true) {
            // Main Menu
            System.out.println("====== Math Challenge Game ======");
            System.out.println("1. Start Game");
            System.out.println("2. Instructions");
            System.out.println("3. Exit");
            System.out.print("Enter choice: ");

            int choice = input.nextInt();

            switch (choice) {
                case 1:
                    startGame();
                    break;
                case 2:
                    showInstructions();
                    break;
                case 3:
                    System.out.println("Exiting game. Goodbye!");
                    return; // exit program
                default:
                    System.out.println("Invalid choice. Try again.");
            }
        }
    }

    public static void showInstructions() {
        System.out.println("\n--- Instructions ---");
        System.out.println("Solve as many math problems as you can within 60 seconds.");
        System.out.println("Choose a difficulty level: Easy, Medium, or Hard.");
        System.out.println("Each correct answer = 1 point.\n");
    }

    public static void startGame() {
        //Prompts user to choose their difficulty
        System.out.println("\nSelect Difficulty:");
        System.out.println("1. Easy");
        System.out.println("2. Medium");
        System.out.println("3. Hard");
        System.out.print("Enter difficulty: ");
        int difficulty = input.nextInt();

        //initializes Score and startTime
        int score = 0;
        long startTime = System.currentTimeMillis();
        int timeLimit = 60; // 60 seconds

        while ((System.currentTimeMillis() - startTime) / 1000 < timeLimit) {
            String question = generateQuestion(difficulty);
            int correctAnswer = evaluateQuestion(question);

            System.out.println("Solve: " + question);
            System.out.print("Your answer: ");

            if (input.hasNextInt()) {
                int playerAnswer = input.nextInt();
                if (playerAnswer == correctAnswer) {
                    System.out.println("Correct!\n");
                    score++;
                } else {
                    System.out.println("Wrong! The correct answer was: " + correctAnswer + "\n");
                }
            } else {
                System.out.println("Invalid input! Numbers only.\n");
                input.next(); // clear invalid input
            }
        }

        System.out.println("\nTime's up! Your final score is: " + score + "\n");
    }

    public static String generateQuestion(int difficulty) {
        int num1, num2;
        char operator;

        switch (difficulty) {
            case 1: // Easy
                num1 = rand.nextInt(10) + 1;
                num2 = rand.nextInt(10) + 1;
                operator = rand.nextBoolean() ? '+' : '-';
                break;
            case 2: // Medium
                num1 = rand.nextInt(20) + 1;
                char[] opsMedium = {'*', '/'}; // Only multiplication and division
                operator = opsMedium[rand.nextInt(opsMedium.length)];
                if (operator == '/') {
                    num2 = rand.nextInt(19) + 2; // Avoids division by 1, which isn't challenging
                    num1 = num2 * (rand.nextInt(10) + 1); // Ensures num1 is a multiple of num2
                } else {
                    num2 = rand.nextInt(20) + 1;
                }
                break;
            case 3: // Hard
                char[] opsHard = {'+', '-', '*', '/'}; // All operators
                operator = opsHard[rand.nextInt(opsHard.length)];
                if (operator == '/') {
                    num2 = rand.nextInt(49) + 2; // Avoids division by 1
                    num1 = num2 * (rand.nextInt(25) + 1); // Ensures num1 is a multiple of num2
                } else {
                    num1 = rand.nextInt(50) + 1;
                    num2 = rand.nextInt(50) + 1;
                }
                break;
            default:
                num1 = 1;
                num2 = 1;
                operator = '+';
        }
        return num1 + " " + operator + " " + num2;
    }

    public static int evaluateQuestion(String question) {
        String[] parts = question.split(" ");
        int num1 = Integer.parseInt(parts[0]);
        char operator = parts[1].charAt(0);
        int num2 = Integer.parseInt(parts[2]);

        switch (operator) {
            case '+': return num1 + num2;
            case '-': return num1 - num2;
            case '*': return num1 * num2;
            case '/': return num1 / num2; // integer division
            default: return 0;
        }
    }
}
